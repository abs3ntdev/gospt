pipeline:
  build:
    image: golang:1.19
    commands:
      - go build -o gospt
      - ./gospt completion zsh > gospt_zsh
      - ./gospt completion bash > gospt_bash
      - ./gospt completion fish > gospt_fish

  publish:
    image: woodpeckerci/plugin-gitea-release
    settings:
      skip_verify: true
      base_url: https://gitea.asdf.cafe
      files:
        - gospt
        - gospt_zsh
        - gospt_bash
        - gospt_fish
      api_key:
        from_secret: GITEA_KEY
      checksum: sha256
    when:
      event: tag
      branch: master
